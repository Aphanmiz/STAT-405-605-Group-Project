---
title: "02: SD line, GoA, Regression"
author: "STAT 410 - Roberto Bertolusso"
date: "Corresponding date"
output: ioslides_presentation
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```


## What we know so far

* *Correlation coefficient*: measure of **linear** association,
  or clustering about a line (which line?).

$$
r = \frac{\sum_{i=1}^n(x_i-\bar{x})(y_i-\bar{y})}
    {\sqrt{\sum_{i=1}^n (x_i-\bar{x})^2}\sqrt{\sum_{i=1}^n (y_i-\bar{y})^2}}
$$

##  
* *If* the scatterplot of both variables is a *football-shaped*
cloud of points, we can *summarize* the relationship between both
variables with:
    * average of x-values, SD of x-values,
    * average of y-values, SD of y-values.
    * the correlation coefficient r.

```{r, message=FALSE}
library(UsingR)

## Pearson's data
## Father and son data
data(father.son)
x <- father.son$fheight
y <- father.son$sheight
```
<table><tr><td>
```{r, echo=TRUE}
(meanx <- mean(x))
sd(x)
```
</td><td>
```{r, echo=TRUE}
(meany <- mean(y))
sd(y)
```
</td><td>
```{r, echo=TRUE}
(r <- cor(x, y))
```
</td></tr></table>


## Which standard deviation?

* For simplicity, FPP uses, unless in the presence of a very small sample, SD instead of sd.
* SD is obtained by dividing by $n$ instead of by $n - 1$ (R has `sd`
function for the latter, and no function for the former).

$$
  \text{SD}_X=\sqrt{\frac{1}{n}\sum_{i=1}^n (X_i-\bar{X})^2} ~~~~~~ \text{sd}_X=\sqrt{\frac{1}{n-1}\sum_{i=1}^n (X_i-\bar{X})^2}
$$

* The preferred one is sd, (as the associated sample variance $\hat\sigma^2$
is an unbiased estimator of the population variance, while the
other is biased).

##
* In the case of Pearson's data (1,078) the difference by using SD instead of sd is:

```{r, echo=TRUE}
## FPP version of sample standard deviation
SD <- function(x) sqrt(mean((x-mean(x))^2))
```

* Difference (in inches) of using SD instead of sd:
```{r, echo=TRUE}
SD(x) - sd(x)
SD(y) - sd(y)
```
which is negligible.

##
* Note: the *maximum likelihood* estimator of the variance also divides by $n$ instead of $n-1$, so it is biased (and used).
* Also, *both* SD and sd are biased estimators of $\sigma$.
* We will illustrate both approaches, that lead mostly to the same *final* results, pointing out when they disagree.


## The SD line
```{r SDline, echo=FALSE, fig.width=5, fig.height=5, fig.align='center'}
par(mai = c(.5, .5, .3, .1), mgp = c(1.5, 0.3, 0), tck = -.01)
plot(x, y,
     xlim = c(58, 80), ylim = c(58, 80),
     xaxt = "n", yaxt = "n", xaxs = "i", yaxs = "i",
     main = "Pearson's data. SD line",
     xlab = "Father height in inches", ylab = "Son height in inches")
axp <- seq(58, 80, by = 2)
axis(1, at = axp, labels = axp)
axis(2, at = axp, labels = axp)

## Spread of the cloud
abline(v=meanx+c(-1,1)*sd(x), col="blue", lty=3)
abline(h=meany+c(-1,1)*sd(y), col="blue", lty=3)
abline(v=meanx+c(-2,2)*sd(x), col="blue", lty=3)
abline(h=meany+c(-2,2)*sd(y), col="blue", lty=3)
abline(v=meanx+c(-3,3)*sd(x), col="blue", lty=3)
abline(h=meany+c(-3,3)*sd(y), col="blue", lty=3)

## Point of averages (center of the cloud)
abline(v=meanx, col="green")
abline(h=meany, col="green")

## SD line using equation and FFP SD
abline(a = meany - SD(y)/SD(x)*meanx,
       b = SD(y)/SD(x), col = "blue", lwd = 4)

## SD line using equation and sd
abline(a = meany - sd(y)/sd(x)*meanx,
       b = sd(y)/sd(x), col = "blue", lwd = 4)
```

##
* Find the equation of the SD line, knowing that it passes throught two points:
    * $(\bar{x},\bar{y})$ and $(\bar{x}+\text{SD}_x,\bar{y}+\text{SD}_y)$ or
    * $(\bar{x},\bar{y})$ and $(\bar{x}+\text{sd}_x,\bar{y}+\text{sd}_y)$


* The result should be:
$$
y=\frac{\text{SD}_y}{\text{SD}_x} x+\bar{y}-\frac{\text{SD}_y}{\text{SD}_x}\bar{x}
$$
where $\frac{\text{SD}_y}{\text{SD}_x}$ is the slope and $\bar{y}-\frac{\text{SD}_y}{\text{SD}_x}\bar{x}$
is the intercept.

* Alternatively:
$$
y=\frac{\text{sd}_y}{\text{sd}_x} x+\bar{y}-\frac{\text{sd}_y}{\text{sd}_x}\bar{x}
$$

##
```{r, echo=FALSE}
library(shiny)

# Define UI for application that draws a histogram
ui <- fluidPage(
   
   # Application title
   titlePanel("Old Faithful Geyser Data"),
   
   # Sidebar with a slider input for number of bins 
   sidebarLayout(
      sidebarPanel(
         sliderInput("bins",
                     "Number of bins:",
                     min = 1,
                     max = 50,
                     value = 30)
      ),
      
      # Show a plot of the generated distribution
      mainPanel(
         plotOutput("distPlot")
      )
   )
)

# Define server logic required to draw a histogram
server <- function(input, output) {
   
   output$distPlot <- renderPlot({
      # generate bins based on input$bins from ui.R
      x    <- faithful[, 2] 
      bins <- seq(min(x), max(x), length.out = input$bins + 1)
      
      # draw the histogram with the specified number of bins
      hist(x, breaks = bins, col = 'darkgray', border = 'white')
   })
}

# Run the application 
shinyApp(ui = ui, server = server)
```

##
* Note: the *maximum likelihood* estimator of the variance also divides by $n$ instead of $n-1$, so it is biased (and used).
* Also, *both* SD and sd are biased estimators of $\sigma$.
* We will illustrate both approaches, that lead mostly to the same *final* results, pointing out when they disagree.

